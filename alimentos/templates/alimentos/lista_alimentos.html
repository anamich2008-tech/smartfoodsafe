<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFoodSafe | Dashboard Pro</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary-red: #E50914;
            --deep-black: #080808;
            --neon-blue: #00d4ff;
            --vencido: #ff0000;
            --por-vencer: #ffcc00;
            --fresco: #22c55e;
            --glow-red: rgba(255, 0, 0, 0.6);
        }

        body {
            background-color: var(--deep-black);
            font-family: 'Poppins', sans-serif;
            color: white;
            margin: 0;
            overflow-x: hidden;
        }

        /* --- ESTAD√çSTICAS DE CRISTAL (NUEVO) --- */
        .stats-container {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            margin: -60px 5% 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 100;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }
        .stat-item { text-align: center; }
        .stat-value { display: block; font-size: 2rem; font-weight: 800; font-family: 'Bebas Neue'; line-height: 1; }
        .stat-label { font-size: 0.7rem; color: #8c8c8c; text-transform: uppercase; letter-spacing: 1px; }

        /* --- FILTROS ESTILO NETFLIX (NUEVO) --- */
        .filter-container { padding: 0 5%; display: flex; gap: 12px; margin-bottom: 10px; flex-wrap: wrap; }
        .btn-filter {
            background: #1a1a1a; border: 1px solid #333; color: #8c8c8c;
            padding: 6px 18px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;
            transition: 0.3s;
        }
        .btn-filter:hover, .btn-filter.active {
            background: var(--primary-red); border-color: var(--primary-red);
            color: white; box-shadow: 0 0 15px var(--glow-red);
        }

        /* --- ESTADOS VAC√çOS (NUEVO) --- */
        .empty-state {
            text-align: center; padding: 80px 20px; background: rgba(255, 255, 255, 0.02);
            border-radius: 20px; margin: 20px 5%; border: 2px dashed #333;
        }

        /* --- TUS ANIMACIONES DE PARPADEO --- */
        @keyframes pulse-red {
            0% { box-shadow: 0 0 5px var(--vencido); border-color: var(--vencido); }
            50% { box-shadow: 0 0 25px var(--vencido); border-color: #ff4d4d; }
            100% { box-shadow: 0 0 5px var(--vencido); border-color: var(--vencido); }
        }
        @keyframes pulse-yellow {
            0% { box-shadow: 0 0 5px var(--por-vencer); border-color: var(--por-vencer); }
            50% { box-shadow: 0 0 15px var(--por-vencer); border-color: #ffe066; }
            100% { box-shadow: 0 0 5px var(--por-vencer); border-color: var(--por-vencer); }
        }
        .card-vencido-animada { animation: pulse-red 1.5s infinite; border: 2px solid var(--vencido) !important; }
        .card-proximo-animada { animation: pulse-yellow 2s infinite; border: 2px solid var(--por-vencer) !important; }

        /* --- ESTILOS BASE DE TU DASHBOARD --- */
        .bg-bubbles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .bubble { position: absolute; bottom: -100px; background: rgba(0, 212, 255, 0.05); border-radius: 50%; animation: float 15s infinite ease-in; }
        @keyframes float { 0% { transform: translateY(0) rotate(0deg); opacity: 0; } 50% { opacity: 0.3; } 100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; } }

        .navbar { background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, transparent 100%); padding: 25px 5%; position: absolute; width: 100%; z-index: 1000; }
        .navbar-brand { font-family: 'Bebas Neue'; font-size: 2.2rem; color: var(--primary-red) !important; text-shadow: 2px 2px 10px rgba(229, 9, 20, 0.4); }

        .hero-section {
            height: 75vh;
            background: linear-gradient(rgba(0,0,0,0.2), var(--deep-black)), 
                        url('https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=2069');
            background-size: cover; background-position: center; display: flex; align-items: center; padding: 0 8%;
        }
        .hero-title { font-weight: 800; font-size: clamp(2.5rem, 6vw, 5.5rem); line-height: 1.1; }
        .hero-title span { color: var(--neon-blue); text-shadow: 0 0 20px var(--neon-blue); }

        .section-title { padding: 40px 5% 10px; font-family: 'Bebas Neue'; font-size: 2.2rem; letter-spacing: 2px; }
        .netflix-row { display: flex; gap: 25px; overflow-x: auto; padding: 20px 5% 60px; scrollbar-width: none; }
        .netflix-row::-webkit-scrollbar { display: none; }

        .food-card { flex: 0 0 320px; height: 210px; background: #1a1a1a; border-radius: 15px; position: relative; transition: 0.4s; border: 1px solid #333; overflow: hidden; }
        .food-card:hover { transform: scale(1.05); z-index: 100; border-color: white; }
        
        .card-overlay { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.95) 80%); }
        .food-name { font-size: 1.6rem; font-weight: 800; margin: 0; }
        .food-card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        
        .badge-bubble { position: absolute; top: 15px; right: 15px; padding: 6px 14px; border-radius: 8px; font-weight: 900; font-size: 0.75rem; z-index: 200; }
        .btn-status { border: none; width: 100%; padding: 8px; border-radius: 6px; font-weight: 700; font-size: 0.85rem; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; }
        
        .btn-delete-food { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.6); width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; z-index: 300; opacity: 0; transition: 0.3s; }
        .food-card:hover .btn-delete-food { opacity: 1; }
    </style>
</head>
<body>

<div class="bg-bubbles">
    <div class="bubble" style="left: 5%; width: 80px; height: 80px; animation-delay: 0s;"></div>
    <div class="bubble" style="left: 50%; width: 60px; height: 60px; animation-delay: 4s;"></div>
    <div class="bubble" style="left: 80%; width: 90px; height: 90px; animation-delay: 1s;"></div>
</div>

<nav class="navbar d-flex justify-content-between">
    <a href="{% url 'lista_alimentos' %}" class="navbar-brand">SMARTFOODSAFE</a>
    <div class="d-flex gap-4 align-items-center">
        <a href="{% url 'lista_compras' %}" class="text-white text-decoration-none fw-bold small">üõí COMPRAS</a>
        <a href="{% url 'lista_recetas' %}" class="text-white text-decoration-none fw-bold small">üç≥ RECETAS</a>
        <a href="{% url 'agregar_alimento' %}" class="btn btn-danger btn-sm fw-bold px-3">+ ALIMENTO</a>
    </div>
</nav>

<section class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">TU REFRI,<br><span>BAJO CONTROL.</span></h1>
        <p class="text-white-50 mt-3" style="max-width: 500px;">Gestiona tu stock con inteligencia y salva el planeta.</p>
        <a href="{% url 'lista_recetas' %}" class="btn btn-light fw-800 px-4 py-2 mt-3">‚ñ∂ EXPLORAR RECETAS</a>
    </div>
</section>

<div class="stats-container">
    <div class="stat-item">
        <span class="stat-value text-white" id="count-total">0</span>
        <span class="stat-label">Stock Total</span>
    </div>
    <div class="stat-item">
        <span class="stat-value text-success" id="count-fresco">0</span>
        <span class="stat-label">Frescos üçè</span>
    </div>
    <div class="stat-item">
        <span class="stat-value text-warning" id="count-proximo">0</span>
        <span class="stat-label">Por Vencer ‚è≥</span>
    </div>
    <div class="stat-item">
        <span class="stat-value text-danger" id="count-vencido">0</span>
        <span class="stat-label">Vencidos üö®</span>
    </div>
</div>

<div class="filter-container">
    <button class="btn-filter active" onclick="filtrarAlimentos('todos', this)">VER TODO</button>
    <button class="btn-filter" onclick="filtrarAlimentos('rojo', this)">SOLO VENCIDOS</button>
    <button class="btn-filter" onclick="filtrarAlimentos('amarillo', this)">POR VENCER</button>
    <button class="btn-filter" onclick="filtrarAlimentos('verde', this)">FRESCOS</button>
</div>

<h4 class="section-title">üì∫ MI INVENTARIO ACTUAL</h4>
<div class="netflix-row" id="main-inventory">
    {% for alimento in alimentos %}
    <div class="food-card item-alimento 
        {% if alimento.estado == 'rojo' %} card-vencido-animada 
        {% elif alimento.estado == 'amarillo' %} card-proximo-animada 
        {% endif %}" data-estado="{{ alimento.estado }}">
        
        <a href="javascript:void(0)" class="btn-delete-food" onclick="confirmarBorrado('{% url 'eliminar_alimento' alimento.id %}', '{{ alimento.nombre }}')">
            <span>üóëÔ∏è</span>
        </a>

        <div class="badge-bubble" style="background: {% if alimento.estado == 'rojo' %}var(--vencido){% elif alimento.estado == 'amarillo' %}var(--por-vencer){% else %}var(--fresco){% endif %}; color: {% if alimento.estado == 'amarillo' %}black{% else %}white{% endif %};">
            {% if alimento.estado == 'rojo' %} ¬°VENCIDO! {% elif alimento.estado == 'amarillo' %} USAR YA {% else %} FRESCO {% endif %}
        </div>

        {% if alimento.foto %}
            <img src="{{ alimento.foto.url }}">
        {% else %}
            <img src="https://images.unsplash.com/photo-1610348725531-843dff563e2c?q=80&w=400">
        {% endif %}

        <div class="card-overlay">
            <p class="food-name">{{ alimento.nombre }}</p>
            <p class="small text-white-50 mb-2">Vence: {{ alimento.fecha_caducidad }}</p>
            
            {% if alimento.estado == 'rojo' %}
                <button class="btn-status btn-danger text-white" onclick="confirmarBorrado('{% url 'eliminar_alimento' alimento.id %}', '{{ alimento.nombre }}')">üóëÔ∏è DES√âCHALO</button>
            {% elif alimento.estado == 'amarillo' %}
                <a href="{% url 'lista_recetas' %}" class="btn-status btn-warning text-dark">üîç BUSCAR RECETA</a>
            {% else %}
                <a href="{% url 'lista_recetas' %}" class="btn-status bg-white text-dark">ü•ó FRESCO</a>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="empty-state w-100">
        <span style="font-size: 50px;">üßä</span>
        <h3 class="mt-3">¬°Huele a limpio!</h3>
        <p class="text-white-50">Tu refrigerador est√° vac√≠o. A√±ade algo para empezar.</p>
        <a href="{% url 'agregar_alimento' %}" class="btn btn-danger">+ AGREGAR PRIMER ALIMENTO</a>
    </div>
    {% endfor %}
</div>

<h4 class="section-title">üë®‚Äçüç≥ RECOMENDACIONES DEL CHEF</h4>
<div class="netflix-row">
    <div class="food-card" onclick="location.href='{% url 'lista_recetas' %}'">
        <img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=400">
        <div class="card-overlay">
            <p class="food-name">Mis Recetas</p>
            <small class="text-warning">Explorar cat√°logo</small>
        </div>
    </div>
</div>

<script>
// --- MOTOR DE ESTAD√çSTICAS Y FILTROS ---
document.addEventListener('DOMContentLoaded', function() {
    actualizarContadores();
});

function actualizarContadores() {
    const total = document.querySelectorAll('.item-alimento').length;
    const vencidos = document.querySelectorAll('.item-alimento[data-estado="rojo"]').length;
    const proximos = document.querySelectorAll('.item-alimento[data-estado="amarillo"]').length;
    const frescos = total - (vencidos + proximos);

    document.getElementById('count-total').innerText = total;
    document.getElementById('count-vencido').innerText = vencidos;
    document.getElementById('count-proximo').innerText = proximos;
    document.getElementById('count-fresco').innerText = frescos;
}

function filtrarAlimentos(estado, btn) {
    document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const cards = document.querySelectorAll('.item-alimento');
    cards.forEach(card => {
        if (estado === 'todos' || card.getAttribute('data-estado') === estado) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function confirmarBorrado(url, nombre) {
    Swal.fire({
        title: '¬øSacar de la despensa?',
        text: `Vas a eliminar "${nombre}".`,
        icon: 'warning',
        showCancelButton: true,
        background: '#141414',
        color: '#fff',
        confirmButtonColor: '#E50914',
        confirmButtonText: 'S√≠, eliminar',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = url;
        }
    });
}
</script>

</body>
</html>